---
- name: Enable container logging to Docker host's syslog file
  hosts: slave_deb
  become: true
  
  vars:
      dest_file: /etc/docker/daemon.json
  
  tasks:
    - name: Edit daemon.json, if only it exists
      stat:
        path: {{ dest_file }}
      register: file_status
      ansible.builtin.lineinfile:
        path: {{ dest_file }}
        regexp: '^"log-driver":.*$'
        line: '"log-driver": "syslog"'
      when: file_status.stat.exists

    - name: Add a line to a daemon.json if the file does not exist
      ansible.builtin.lineinfile:
        path: {{ dest_file }}
        line: {\n\t"log-driver": "syslog"\n}
        create: yes
      when: not file_status.stat.exists
